services:
  agent-manager:
    command:
    - agent-manager-react
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  api-gateway:
    command:
    - api-gateway
    - -p
    - pulsar://pulsar:6650
    - --timeout
    - '600'
    - --port
    - '8088'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.1'
          memory: 512M
    environment:
      GATEWAY_SECRET: ${GATEWAY_SECRET}
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    ports:
    - 8088:8088
    restart: on-failure:100
  bookie:
    command:
    - bash
    - -c
    - bin/apply-config-from-env.py conf/bookkeeper.conf && exec bin/pulsar bookie
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1024M
        reservations:
          cpus: '0.1'
          memory: 1024M
    environment:
      BOOKIE_MEM: -Xms256m -Xmx256m -XX:MaxDirectMemorySize=256m
      advertisedAddress: bookie
      bookieId: bookie
      clusterName: cluster-a
      metadataStoreUri: metadata-store:zk:zookeeper:2181
      zkServers: zookeeper:2181
    image: docker.io/apachepulsar/pulsar:4.1.0
    ports:
    - 3181:3181
    restart: on-failure:100
    user: 0:1000
    volumes:
    - bookie:/pulsar/data/bookkeeper
  cassandra:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1000M
        reservations:
          cpus: '0.5'
          memory: 1000M
    environment:
      JVM_OPTS: -Xms300M -Xmx300M -Dcassandra.skip_wait_for_gossip_to_settle=0
    image: docker.io/cassandra:4.1.10
    ports:
    - 9042:9042
    restart: on-failure:100
    volumes:
    - cassandra:/var/lib/cassandra
  chunker:
    command:
    - chunker-recursive
    - -p
    - pulsar://pulsar:6650
    - --chunk-size
    - '2000'
    - --chunk-overlap
    - '100'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  config-svc:
    command:
    - config-svc
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  ddg-mcp-server:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 256M
    image: docker.io/trustgraph/ddg-mcp-server:0.1.0
    ports:
    - 9870:9870
    restart: on-failure:100
  document-embeddings:
    command:
    - document-embeddings
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 512M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  document-rag:
    command:
    - document-rag
    - -p
    - pulsar://pulsar:6650
    - --doc-limit
    - '20'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  embeddings:
    command:
    - embeddings-fastembed
    - -p
    - pulsar://pulsar:6650
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 400M
        reservations:
          cpus: '0.5'
          memory: 400M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  garage:
    command:
    - /garage
    - -c
    - /etc/garage/garage.toml
    - server
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 512M
    environment:
      RUST_LOG: garage=info
    image: docker.io/dxflrs/garage:v2.1.0
    ports:
    - 3900:3900
    - 3901:3901
    - 3902:3902
    - 3903:3903
    - 3904:3904
    restart: on-failure:100
    volumes:
    - ./garage:/etc/garage/
    - garage-meta:/var/lib/garage/meta
    - garage-data:/var/lib/garage/data
  garage-init:
    command:
    - sh
    - -c
    - "set -e\n\n# Install required tools\necho \"Installing curl, jq and downloading\
      \ garage CLI...\"\napk add --no-cache curl jq\n\n# Download garage binary (v2.1.0)\
      \ for remote management\ncurl -fsSL \"https://garagehq.deuxfleurs.fr/_releases/v2.1.0/x86_64-unknown-linux-musl/garage\"\
      \ \\\n    -o /usr/local/bin/garage\nchmod +x /usr/local/bin/garage\n\necho \"\
      Waiting for Garage daemon to be ready...\"\nMAX_ATTEMPTS=60\nATTEMPT=0\n# Wait\
      \ for /health to respond (even 503 is fine - means daemon is up)\nuntil curl\
      \ -s http://garage:3903/health >/dev/null 2>&1; do\n    ATTEMPT=$$((ATTEMPT+1))\n\
      \    if [ $$ATTEMPT -ge $$MAX_ATTEMPTS ]; then\n        echo \"ERROR: Garage\
      \ failed to become ready after $${MAX_ATTEMPTS} attempts\"\n        exit 1\n\
      \    fi\n    echo \"Attempt $${ATTEMPT}/$${MAX_ATTEMPTS}: Garage not ready,\
      \ retrying in 2s...\"\n    sleep 2\ndone\necho \"Garage daemon is ready.\"\n\
      \n# Get the node ID via v2 Admin API\necho \"Getting Garage node ID via Admin\
      \ API...\"\ncurl -s -H \"Authorization: Bearer $${GARAGE_ADMIN_TOKEN}\" \\\n\
      \    \"http://garage:3903/v2/GetNodeInfo?node=self\" > /tmp/garage-node-info.json\n\
      \n# Extract node ID from response (the key in success map is the node ID)\n\
      NODE_ID=$$(jq -r '.success | to_entries[0].value.nodeId' /tmp/garage-node-info.json)\n\
      echo \"Node ID: $${NODE_ID}\"\n\nif [ -z \"$$NODE_ID\" ] || [ \"$$NODE_ID\"\
      \ = \"null\" ]; then\n    echo \"ERROR: Failed to retrieve node ID\"\n    exit\
      \ 1\nfi\n\n# ===== LAYOUT MANAGEMENT VIA REMOTE RPC =====\n# Use garage CLI\
      \ with -h and -s flags to connect remotely\n# -h requires format: <node-id>@<host>:<port>\n\
      # -s provides the RPC secret\n\n# Construct full RPC identifier\nRPC_HOST=\"\
      $${NODE_ID}@garage:3901\"\necho \"RPC Host: $${RPC_HOST}\"\n\n# Check current\
      \ layout to see if node is already assigned (idempotent)\necho \"Checking current\
      \ cluster layout...\"\nLAYOUT_OUTPUT=$$(garage -h \"$${RPC_HOST}\" -s \"$${GARAGE_RPC_SECRET}\"\
      \ layout show 2>&1)\n\n# Check if node already has a role assigned\n# Layout\
      \ output shows abbreviated node ID (first 16 chars)\nNODE_ID_SHORT=\"$${NODE_ID:0:16}\"\
      \nif echo \"$$LAYOUT_OUTPUT\" | grep -q \"$$NODE_ID_SHORT\"; then\n    echo\
      \ \"Node $${NODE_ID_SHORT}... already assigned in layout, skipping.\"\nelse\n\
      \    echo \"Assigning node to cluster layout...\"\n    # Assign node to zone\
      \ dc1 with configured capacity\n    garage -h \"$${RPC_HOST}\" -s \"$${GARAGE_RPC_SECRET}\"\
      \ \\\n        layout assign $${NODE_ID} -z dc1 -c $${GARAGE_DATA_SIZE}\n\n \
      \   echo \"Applying layout configuration...\"\n    # Get current staged version\
      \ and apply\n    garage -h \"$${RPC_HOST}\" -s \"$${GARAGE_RPC_SECRET}\" \\\n\
      \        layout apply --version 1\n\n    echo \"Layout configured successfully.\"\
      \n    # Wait for layout to stabilize\n    sleep 5\nfi\n\n# ===== KEY MANAGEMENT\
      \ VIA REMOTE RPC =====\n\n# Check if key already exists (idempotent)\n# GARAGE_ACCESS_KEY\
      \ is already a valid Garage Key ID (GK + 24 hex chars)\nif garage -h \"$${RPC_HOST}\"\
      \ -s \"$${GARAGE_RPC_SECRET}\" key info \"$${GARAGE_ACCESS_KEY}\" >/dev/null\
      \ 2>&1; then\n    echo \"Access key $${GARAGE_ACCESS_KEY} already exists, skipping\
      \ creation.\"\nelse\n    echo \"Importing S3 access key: $${GARAGE_ACCESS_KEY}\"\
      \n\n    # Import key with the provided credentials (both already in valid Garage\
      \ format)\n    # GARAGE_ACCESS_KEY = Key ID (GK + 24 hex chars)\n    # GARAGE_SECRET_KEY\
      \ = Secret (64 hex chars)\n    garage -h \"$${RPC_HOST}\" -s \"$${GARAGE_RPC_SECRET}\"\
      \ \\\n        key import \"$${GARAGE_ACCESS_KEY}\" \"$${GARAGE_SECRET_KEY}\"\
      \ --yes\n\n    echo \"Access key imported successfully.\"\nfi\n\n# Grant permissions\
      \ to the key\necho \"Granting create-bucket permission to key...\"\ngarage -h\
      \ \"$${RPC_HOST}\" -s \"$${GARAGE_RPC_SECRET}\" \\\n    key allow --create-bucket\
      \ \"$${GARAGE_ACCESS_KEY}\"\n\necho \"\"\necho \"Garage initialization complete!\"\
      \necho \"S3 Endpoint: http://garage:3900\"\necho \"Region: $${GARAGE_REGION}\"\
      \nexit 0\n"
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    environment:
      GARAGE_ACCESS_KEY: GK000000000000000000000001
      GARAGE_ADMIN_TOKEN: batts-rockhearted-unpartially
      GARAGE_DATA_SIZE: 5G
      GARAGE_REGION: garage
      GARAGE_RPC_SECRET: bbba746a9e289bad64a9e7a36a4299dac8d6e0b8cc2a6c2937fe756df4492008
      GARAGE_SECRET_KEY: b171f00be9be4c32c734f4c05fe64c527a8ab5eb823b376cfa8c2531f70fc427
    image: docker.io/alpine:3.23.2
    restart: on-failure:100
    volumes:
    - ./garage:/etc/garage/
  grafana:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 256M
        reservations:
          cpus: '0.5'
          memory: 256M
    environment:
      GF_ORG_NAME: trustgraph.ai
    image: docker.io/grafana/grafana:12.3.0
    ports:
    - 3000:3000
    restart: on-failure:100
    volumes:
    - grafana-storage:/var/lib/grafana
    - ./grafana/provisioning/:/etc/grafana/provisioning/dashboards/
    - ./grafana/provisioning/:/etc/grafana/provisioning/datasources/
    - ./grafana/dashboards/:/var/lib/grafana/dashboards/
  graph-embeddings:
    command:
    - graph-embeddings
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 512M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  graph-rag:
    command:
    - graph-rag
    - -p
    - pulsar://pulsar:6650
    - --entity-limit
    - '50'
    - --triple-limit
    - '30'
    - --max-subgraph-size
    - '400'
    - --max-path-length
    - '2'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  init-trustgraph:
    command:
    - tg-init-trustgraph
    - -p
    - http://pulsar:8080
    - --config-file
    - /trustgraph/config.json
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
    volumes:
    - ./trustgraph:/trustgraph/
  kg-extract-agent:
    command:
    - kg-extract-agent
    - -p
    - pulsar://pulsar:6650
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  kg-extract-definitions:
    command:
    - kg-extract-definitions
    - -p
    - pulsar://pulsar:6650
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  kg-extract-objects:
    command:
    - kg-extract-objects
    - -p
    - pulsar://pulsar:6650
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  kg-extract-ontology:
    command:
    - kg-extract-ontology
    - -p
    - pulsar://pulsar:6650
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 300M
        reservations:
          cpus: '0.1'
          memory: 300M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  kg-extract-relationships:
    command:
    - kg-extract-relationships
    - -p
    - pulsar://pulsar:6650
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  kg-manager:
    command:
    - kg-manager
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  kg-store:
    command:
    - kg-store
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  librarian:
    command:
    - librarian
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    - --object-store-endpoint
    - garage:3900
    - --object-store-access-key
    - GK000000000000000000000001
    - --object-store-secret-key
    - b171f00be9be4c32c734f4c05fe64c527a8ab5eb823b376cfa8c2531f70fc427
    - --object-store-region
    - garage
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 256M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  loki:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 256M
    image: docker.io/grafana/loki:3.6.2
    ports:
    - 3100:3100
    restart: on-failure:100
    volumes:
    - ./loki:/etc/loki/
    - loki-data:/loki
  mcp-server:
    command:
    - mcp-server
    - --port
    - '8000'
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 256M
    environment:
      MCP_SERVER_SECRET: ${MCP_SERVER_SECRET}
    image: docker.io/trustgraph/trustgraph-mcp:1.8.12
    ports:
    - 8000:8000
    restart: on-failure:100
  mcp-tool:
    command:
    - mcp-tool
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  metering:
    command:
    - metering
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  metering-rag:
    command:
    - metering
    - -p
    - pulsar://pulsar:6650
    - --id
    - metering-rag
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  nlp-query:
    command:
    - nlp-query
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  pdf-decoder:
    command:
    - pdf-decoder
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.1'
          memory: 512M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  prometheus:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/prom/prometheus:v3.8.0
    ports:
    - 9090:9090
    restart: on-failure:100
    volumes:
    - ./prometheus:/etc/prometheus/
    - prometheus-data:/prometheus
  prompt:
    command:
    - prompt-template
    - -p
    - pulsar://pulsar:6650
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  prompt-rag:
    command:
    - prompt-template
    - -p
    - pulsar://pulsar:6650
    - --id
    - prompt-rag
    - --concurrency
    - '1'
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  pulsar:
    command:
    - bash
    - -c
    - bin/apply-config-from-env.py conf/broker.conf && exec bin/pulsar broker
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 800M
        reservations:
          cpus: '0.1'
          memory: 800M
    environment:
      PULSAR_MEM: -Xms384m -Xmx384m -XX:MaxDirectMemorySize=384m
      advertisedAddress: pulsar
      advertisedListeners: external:pulsar://pulsar:6650,localhost:pulsar://localhost:6650
      clusterName: cluster-a
      managedLedgerDefaultAckQuorum: '1'
      managedLedgerDefaultEnsembleSize: '1'
      managedLedgerDefaultWriteQuorum: '1'
      metadataStoreUrl: zk:zookeeper:2181
      zookeeperServers: zookeeper:2181
    image: docker.io/apachepulsar/pulsar:4.1.0
    ports:
    - 6650:6650
    - 8080:8080
    restart: on-failure:100
  pulsar-init:
    command:
    - bash
    - -c
    - sleep 10 && bin/pulsar initialize-cluster-metadata --cluster cluster-a --zookeeper
      zookeeper:2181 --configuration-store zookeeper:2181 --web-service-url http://pulsar:8080
      --broker-service-url pulsar://pulsar:6650
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 256M
        reservations:
          cpus: '0.05'
          memory: 256M
    environment:
      PULSAR_MEM: -Xms128m -Xmx128m -XX:MaxDirectMemorySize=128m
    image: docker.io/apachepulsar/pulsar:4.1.0
    restart: on-failure:100
  qdrant:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1024M
        reservations:
          cpus: '0.5'
          memory: 1024M
    image: docker.io/qdrant/qdrant:v1.15.4
    ports:
    - 6333:6333
    - 6334:6334
    restart: on-failure:100
    volumes:
    - qdrant:/qdrant/storage
  query-doc-embeddings:
    command:
    - de-query-qdrant
    - -p
    - pulsar://pulsar:6650
    - -t
    - http://qdrant:6333
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  query-graph-embeddings:
    command:
    - ge-query-qdrant
    - -p
    - pulsar://pulsar:6650
    - -t
    - http://qdrant:6333
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  query-objects:
    command:
    - objects-query-cassandra
    - -p
    - pulsar://pulsar:6650
    - --cassandra-host
    - cassandra
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.1'
          memory: 512M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  query-triples:
    command:
    - triples-query-cassandra
    - -p
    - pulsar://pulsar:6650
    - --cassandra-host
    - cassandra
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.1'
          memory: 512M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  store-doc-embeddings:
    command:
    - de-write-qdrant
    - -p
    - pulsar://pulsar:6650
    - -t
    - http://qdrant:6333
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  store-graph-embeddings:
    command:
    - ge-write-qdrant
    - -p
    - pulsar://pulsar:6650
    - -t
    - http://qdrant:6333
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  store-objects:
    command:
    - objects-write-cassandra
    - -p
    - pulsar://pulsar:6650
    - --cassandra-host
    - cassandra
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  store-triples:
    command:
    - triples-write-cassandra
    - -p
    - pulsar://pulsar:6650
    - --cassandra-host
    - cassandra
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 256M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  structured-diag:
    command:
    - structured-diag
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 96M
        reservations:
          cpus: '0.1'
          memory: 96M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  structured-query:
    command:
    - structured-query
    - -p
    - pulsar://pulsar:6650
    - --log-level
    - DEBUG
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    image: docker.io/trustgraph/trustgraph-flow:1.8.12
    restart: on-failure:100
  text-completion:
    command:
    - text-completion-bedrock
    - -p
    - pulsar://pulsar:6650
    - -x
    - '4096'
    - -t
    - '0.000'
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    environment:
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_DEFAULT_REGION: ${AWS_DEFAULT_REGION}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    image: docker.io/trustgraph/trustgraph-bedrock:1.8.12
    restart: on-failure:100
  text-completion-rag:
    command:
    - text-completion-bedrock
    - -p
    - pulsar://pulsar:6650
    - --id
    - text-completion-rag
    - -x
    - '4096'
    - -t
    - '0.000'
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 128M
    environment:
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_DEFAULT_REGION: ${AWS_DEFAULT_REGION}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    image: docker.io/trustgraph/trustgraph-bedrock:1.8.12
    restart: on-failure:100
  workbench-ui:
    deploy:
      resources:
        limits:
          cpus: '0.1'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 256M
    image: docker.io/trustgraph/workbench-ui:1.4.4
    ports:
    - 8888:8888
    restart: on-failure:100
  zookeeper:
    command:
    - bash
    - -c
    - bin/apply-config-from-env.py conf/zookeeper.conf && bin/generate-zookeeper-config.sh
      conf/zookeeper.conf && exec bin/pulsar zookeeper
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.05'
          memory: 512M
    environment:
      PULSAR_MEM: -Xms256m -Xmx256m -XX:MaxDirectMemorySize=256m
      metadataStoreUrl: zk:zookeeper:2181
    image: docker.io/apachepulsar/pulsar:4.1.0
    ports:
    - 2181:2181
    - 2888:2888
    - 3888:3888
    restart: on-failure:100
    user: 0:1000
    volumes:
    - zookeeper:/pulsar/data/zookeeper
volumes:
  bookie: {}
  cassandra: {}
  garage-data: {}
  garage-meta: {}
  grafana-storage: {}
  loki-data: {}
  prometheus-data: {}
  qdrant: {}
  zookeeper: {}

